<launch>
  <arg name="rviz" default="true" />

  <!-- mode: map | test -->
  <arg name="mode" default="map" />

  <!-- common -->
  <arg name="save_path" default="/data/JointCali/tag_test/" />
  <arg name="bagname"   default="Apriltag_Mid360" />

  <!-- test-only inputs -->
  <arg name="map_name"  default="Apriltag_record_map_02" />
  <arg name="score_th"  default="0.15" />

  <!-- computed string for YAML (only meaningful in test mode) -->
  <arg name="previous_map_str"
       default="$(eval arg('map_name') + ': ' + str(arg('score_th')) )" />

  <!-- MAP -->
  <group if="$(eval arg('mode') == 'map')">
    <rosparam subst_value="true" command="load"
              file="$(find voxel_slam)/config/mid360_map_builder.yaml"/>
  </group>

  <!-- TEST -->
  <group if="$(eval arg('mode') == 'test')">
    <rosparam subst_value="true" command="load"
              file="$(find voxel_slam)/config/mid360_relocalization.yaml"/>
  </group>

  <param name="finish" value="false"/>
  <node pkg="voxel_slam" type="voxelslam" name="voxelslam" output="screen" />

  <group if="$(arg rviz)">
    <node launch-prefix="nice"
          pkg="rviz" type="rviz" name="rviz"
          args="-d $(find voxel_slam)/rviz_cfg/back.rviz" />
  </group>
</launch>
